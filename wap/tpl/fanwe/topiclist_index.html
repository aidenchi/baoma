{include file="./inc/header_common.html"}
<style>
.topic_list_top{
	background: #fff;
	width: 100%;
	position: relative;
	height: 40px;	
	display: -webkit-box;
	line-height:40px;
}
.topic_list_top_left{
	background: #eee;
	width: 10%;	
	text-align: center;
	font-size:24px;
	color:#ccc;
}
.topic_list_top_center {
	width: 80%;	
	overflow: hidden;
}
.topic_list_top_center a{
	color:#5B5B5B;
	font-size:16px;
	padding-left:8px;
	padding-right:8px;
}
.topic_list_top_center .selected{
	font-weight: bolder;
	color: #f59436;
}
.topic_list_top_right{
	background: #eee;
	width: 10%;
	text-align: center;
}
.topic_list_top_right a{
	color:#ccc;
	font-size:24px;
}
.topic_list_bg{
	width: 100%;
	height:100px;
	background: #ccc;
}
.topic_search_box {	
	width:100%;
	height: 40px;
	background: #f6f6f6;
	position: relative;	
	display: none;
}
.topic_search_box .search_text {
	width:90%;
	dispalay: inline-block;
	height: 30px;
	padding: 5px;
	position: relative;
}
</style>			
			
			<div class="topic_list_top">
				<div class="topic_list_top_left">
				<i class="fa fa-search"></i>
				</div>
				<div class="topic_list_top_center">						
					<a href='{wap_url a="index" r="topiclist#index"}'><span {if $data.cate_id eq 0}class='selected'{/if}>精选</span></a>
					{foreach from=$data.cate_list item=cate}
					<a href='{wap_url a="index" r="topiclist#index"  p="cid=$cate.id"}'><span {if $data.cate_id eq $cate.id}class='selected'{/if}>{$cate.name}</span></a>
					{/foreach}		
				</div>
				<div class="topic_list_top_right">
				    <a href='{wap_url a="index" r="topicwrite#index"}'>
					<i class="fa fa-edit"></i>
					</a>
				</div>
			</div>
			
			<!--
			<div class="topic_search_box">
				<div class="search_text">					
					<input type="text" placeholder="请输入帖子标题关键字" id="keyword" value="{$data.keyword}">
				</div>
				<div class="search_btn">
					<a href="javascript:void(0);" onclick="search_submit()">搜索</a>
				</div>
			 </div>
			 -->
			 <div class="topic_search_box">
				<div class="search_text">
					<input type="hidden" name="cid" id="cid" value="{$data.cate_id}" />
					<input class="inputtext" type="text" placeholder="请输入帖子标题关键字" id="keyword" value="{$data.keyword}" />
					<input class="inputsubmit" type="button" value="搜索" onclick="search_submit()"/>
				</div>
			 </div>
			
			<div class="topic_list_bg">
				<div style="padding:30px;">贝欧论坛……</div>
			</div>

			<div class="wrap">
					<div class="list-view">
						 <!--<div class="list_title">共{$data.total}篇帖子</div>-->
						 {if $data.one_cate_topic_list}
						 <ul class="">
						 {foreach from=$data.one_cate_topic_list item=topic}
							<li class="topic_li">						 	      
						 	     	<div class="list_item">
						 	     		 <div class="topic_user_headimg">
											{if $data.login_user_id eq $topic.user_id}
											<a href='{wap_url a="index" r="user_center#index"}'>
											{else}
											<a href='{wap_url a="index" r="userinfo#index" p="user_id=$topic.user_id"}'>
											{/if}
						 	     		 	<img src='{function name="get_user_avatar" uid=$topic.user_id type="small" }'>
											{if $topic.is_best gt 0}
											<i class="topic_ico ico">精华</i>
											{/if}
											{if $topic.is_recommend gt 0}
											<i class="topic_ico ico">推荐</i>
											{/if}
											{if $topic.is_top gt 0}
											<i class="topic_ico ico">置顶</i>
											{/if}
											</a>
						 	     		 </div>										 
										 <div class="info">
											<a href='{wap_url a="index" r="topicitem#index"  p="id=$topic.id"}'>
												<i>{$topic.forum_title}</i>
												<h3>{$topic.short_content}</h3>	
											</a>
											<div class="topic_bottom">
												<div style="width:50%">
													<span style="padding-right:5px;">浏览&nbsp;{$topic.hit_count}</span>
													<span style="cursor:pointer; padding-right:5px;" onclick="favorite_topic({$topic.id},{$topic.user_id})">
														{if $topic.is_fav eq 1}
														<font id="fav_text_{$topic.id}">已点赞</font>&nbsp;<font id="fav_count_{$topic.id}">{$topic.fav_count}</font>
														{else}
														<font id="fav_text_{$topic.id}">点赞</font>&nbsp;<font id="fav_count_{$topic.id}">{$topic.fav_count}</font>
														{/if}
													</span>
													<a style="color:#b2b2b2;" href='{wap_url a="index" r="topicitem#index"  p="id=$topic.id"}'>
													<span style="padding-right:5px;">回复&nbsp;{$topic.reply_count}</span>
													</a>
												</div>
												<div style="width:50%; text-align:right;">
													<span style="padding-right:10px;">{$topic.user_name}</span>
													<span style="padding-right:10px;">{function name="pass_date" time=$topic.create_time }</span>
												</div>
						                     </div>											 
										 </div>										 
						 	     	</div>						 	     
								</li>
							{/foreach}							
						 </ul>	
						{if $data.page.page_total gt 1}
						<div class="fy">
							{$pages}
						</div>
						{/if}
						{else}
						 <div class="assess_list" style="text-align:center;padding:10px 0;">该版块还没有帖子</div>
						{/if}
					</div><!--list-view end-->		
				 
				</div><!--wrap end-->	

<script>
function favorite_topic(topic_id,author_user_id){
	//alert(topic_id+"--"+author_user_id);
	var text_id = "fav_text_"+topic_id;
	var count_id = "fav_count_"+topic_id;
	var query = new Object();
	query.topic_id = topic_id;
	query.author_user_id = author_user_id;
	query.post_type = "json";
	var ajaxurl = '{wap_url a="index" r="topicfavorite#index"}';

	$.ajax({
		url:ajaxurl,
		data:query,
		type:"post",
		dataType:"json",
		success:function(data){
			if(data.user_login_status==0){
				alert(data.login_info);
			}else{
				if(data.fav_status == 1){
					alert("取消点赞成功！");					
					document.getElementById(text_id).innerText = "点赞";					
					var fav_count = document.getElementById(count_id).innerText;
					fav_count = parseInt(fav_count) - 1;
					document.getElementById(count_id).innerText = fav_count;
				}
				if(data.fav_status == 2){
					alert("点赞成功！");
					document.getElementById(text_id).innerText = "已点赞";				
					var fav_count = document.getElementById(count_id).innerText;
					fav_count = parseInt(fav_count) + 1;
					document.getElementById(count_id).innerText = fav_count;
				}
				if(data.fav_status == 3){
					alert("操作失败");
				}
				if(data.fav_status == 4){
					alert("自己不能点赞自己的帖子");
				}
			}
		}
		,error:function(){
			alert("服务器提交错误");
		}
	});
}

$(document).ready(function () {   
   $(".topic_list_top_left").click(function(){
       $(".topic_search_box").toggle();
   });
});

//根据帖子标题关键字
function search_submit(){
	window.location.href='index.php?ctl=topiclist&cid='+$("#cid").val()+'&keyword='+$("#keyword").val();
}
</script>
				
{include file="./inc/footer.html"}				
			