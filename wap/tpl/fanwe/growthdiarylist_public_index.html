{if $is_ajax eq 1}
{include file="./inc/growthdiarylist_public_key_item.html"}
<?php die();?>
{/if}
{include file="./inc/header_common.html"}
<style>
.growth_diary_top{
	background: #A2CEA0;
	width: 100%;
	position: relative;
}
.growth_diary_date{
	width: 100%;
	height: 40px;	
}
.growth_diary_user {
	width: 100%;
	height: 180px;	
	text-align: center;
}
.growth_circle{
	width: 100%;
	height: 30px;
	background: #999999;
	opacity: 0.5;
	filter:alpha(opacity=50)
}
.growth_diary_list_table {
	width:100%;
	color: #adadad;
	font-size:12px;
}
.growth_diary_list_table a{
	color: #adadad;
}
.td_line{
	line-height: 22px;
	padding: 10px;
	border-bottom: 1px solid #f5f5f5;
}
.pic_item {
	position: relative;
	width: 100px;
	height: 100px;
	float: left;
	display: inline-block;
	margin-top: 5px;
	margin-right: 5px;
}
</style>
		{if $data.login_user_id gt 0}
			<div class="growth_diary_top">
				<div class="growth_diary_date">
					<div style="float:left;width:50%;text-align:left;">
						<a href='{wap_url a="index" r="growthdiarydate_public#index"}'>
							<span>日历</span>
						</a>
					</div>
					<div style="float:left;width:50%;text-align:right;">
						<a href='{wap_url a="index" r="growthdiarywrite#index"}'>
							<span>记录</span>		
						</a>
					</div>
				</div>
				<div class="growth_diary_user">
					<img style="border-radius:60px;" src='{function name="get_user_avatar" uid=$data.login_user_id type="middle" }'>
					<br/>
					<span style="color:#fff; font-size:18px; line-height:24px;">{$data.login_user_name}</span><br/>
					<span style="color:#fff; font-size:18px; line-height:24px;">{function name="get_user_age_byid" uid=$data.login_user_id}</span>
				 </div>	
				 <div class="growth_circle">
					<a href='{wap_url a="index" r="growthdiarylist#index"}'>
						<span style="padding-left:10px;line-height:30px;font-size:16px;color:#fff;font-weight:bold"><我的成长日记</span>
					</a>
				 </div>
			</div>
		{/if}
			
			<div class="wrap">					
					{if $data.growth_diary_list}					
					<div class="list-view">
						<div class="list_title">成长圈</div>
						<div id="pagecontent">
							{include file="./inc/growthdiarylist_public_key_item.html"}
						</div>						
						<input type="hidden" name="currentpage" id="currentpage" value="{$data.page.page}" />
						<input type="hidden" name="totalpage" id="totalpage" value="{$data.page.page_total}" />
					</div><!--list-view end-->	
					{else}
					<div style="margin-top:10px;margin-bottom:10px;text-align:center;">
					暂无成长日记
					</div>
					{/if}					
					
				</div><!--wrap end-->		

<script type="text/javascript">
function favorite_growth_diary(growth_diary_id,author_user_id){
	//alert(growth_diary_id+"--"+author_user_id);
	var text_id = "fav_text_"+growth_diary_id;
	var count_id = "fav_count_"+growth_diary_id;
	var query = new Object();
	query.growth_diary_id = growth_diary_id;
	query.author_user_id = author_user_id;
	query.post_type = "json";
	var ajaxurl = '{wap_url a="index" r="growthdiaryfavorite#index"}';

	$.ajax({
		url:ajaxurl,
		data:query,
		type:"post",
		dataType:"json",
		success:function(data){
			if(data.user_login_status==0){
				alert(data.login_info);
			}else{
				if(data.fav_status == 1){
					alert("取消喜欢成功！");					
					document.getElementById(text_id).innerText = "喜欢";					
					var fav_count = document.getElementById(count_id).innerText;
					fav_count = parseInt(fav_count) - 1;
					document.getElementById(count_id).innerText = fav_count;
				}
				if(data.fav_status == 2){
					alert("喜欢成功！");
					document.getElementById(text_id).innerText = "已喜欢";				
					var fav_count = document.getElementById(count_id).innerText;
					fav_count = parseInt(fav_count) + 1;
					document.getElementById(count_id).innerText = fav_count;
				}
				if(data.fav_status == 3){
					alert("操作失败");
				}
				if(data.fav_status == 4){
					alert("自己不能喜欢自己的日记");
				}
			}
		}
		,error:function(){
			alert("服务器提交错误");
		}
	});
}


$(window).scroll(function () {
	var scrollTop = $(document).scrollTop();   
    var windowHeight = $(window).height();
	var scrollHeight = $(document).height();
	console.log("滚动条到顶部的垂直高度: "+scrollTop);     
    console.log('浏览器的高度：'+windowHeight);  
	console.log("页面的文档高度 ："+scrollHeight); 
	var proportion = parseFloat((scrollTop + windowHeight)/scrollHeight);
	console.log(proportion); 
    //if (scrollTop + windowHeight == scrollHeight) {   
	if (proportion>0.98){
		//此处是滚动条到底部时候触发的事件，在这里写要加载的数据，或者是拉动滚动条的操作
		var totalpage = parseInt($("#totalpage").val());
		var currentpage = parseInt($("#currentpage").val());
		//alert("currentpage："+currentpage+"------totalpage："+totalpage);
		if(totalpage>1 && currentpage<totalpage){
			//alert("11");
			var page = currentpage+1;
			$("#currentpage").val(page);
			$("#loading").show();
			getNextPageContent(page);
		}else{
			//alert("22");
			$("#loading").slideUp("slow")
		}
    }
});

function getNextPageContent(page){
	var ajaxurl = '/wap/index.php?ctl=growthdiarylist_public&page='+page;
	var query = new Object();
	query.is_ajax=1;
	$.ajax({
		url:ajaxurl,
		data:query,
		type:"Post",
		dataType:"text",
		success:function(data){			
			//$("#pagecontent").html(data);
			$("#loading").slideUp("slow")
			$("#pagecontent").append(data);
		}
		,error:function(){
			//alert("服务器提交错误");
		}
	});	
}
</script>				
{include file="./inc/footer.html"}				
			